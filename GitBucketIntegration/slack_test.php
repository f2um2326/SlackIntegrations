# Commit
$json_str = '{"pusher":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"ref":"refs/heads/support-pullrequest","commits":[{"id":"1faeaefb10fcab7f91668980e77fadeeee38b462","message":"test commit pull request\n","timestamp":"2015-04-24T08:28:24Z","added":["GitBucketIntegration/README.md"],"removed":[],"modified":[],"author":{"name":"shimba","email":"is0020he@ed.ritsumei.ac.jp","date":"2015-04-24T08:28:24Z"},"committer":{"name":"shimba","email":"is0020he@ed.ritsumei.ac.jp","date":"2015-04-24T08:28:24Z"},"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/shimba/SlackIntegrations/commits/1faeaefb10fcab7f91668980e77fadeeee38b462","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/commit/1faeaefb10fcab7f91668980e77fadeeee38b462"}],"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":1,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":1,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"}}';

# Issue Opened
#$json_str = '{"action":"created","repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":12,"title":"WIP support pull request","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"open","created_at":"2015-04-24T08:08:21Z","updated_at":"2015-04-24T08:08:21Z","body":"support pull request webhook"},"comment":{"id":100,"user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"body":"comment test on conversation, comment test on conversation","created_at":"2015-04-24T08:19:29Z","updated_at":"2015-04-24T08:19:29Z"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Issue Commented
#$json_str = '{"action":"created","repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":12,"title":"WIP support pull request","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"open","created_at":"2015-04-24T08:08:21Z","updated_at":"2015-04-24T08:08:21Z","body":"support pull request webhook"},"comment":{"id":101,"user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"body":"こっめんと","created_at":"2015-04-24T08:31:12Z","updated_at":"2015-04-24T08:31:12Z"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Issue Closed
#$json_str = '{"action":"closed","number":23,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":1,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":1,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":23,"title":"Openテスト","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"open","created_at":"2015-04-26T10:25:46Z","updated_at":"2015-04-26T10:25:46Z","body":"テストコメント"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Issue Reopened
#$json_str = '{"action":"reopened","number":23,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":1,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":1,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":23,"title":"Openテスト","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"closed","created_at":"2015-04-26T10:25:46Z","updated_at":"2015-04-26T10:54:53Z","body":"テストコメント"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';

# Pull Request Opened
#$json_str = '{"action":"opened","number":12,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"pull_request":{"number":12,"updated_at":"2015-04-24T08:08:21Z","created_at":"2015-04-24T08:08:21Z","head":{"sha":"a4c1bc4dd850dad12a299dce614fd0d9a6ed256d","ref":"support-pullrequest","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:support-pullrequest","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"ac4bff25f2f5cf7febec1e1d1c4599cbab4653c2","ref":"dev","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:dev","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"WIP support pull request","body":"support pull request webhook","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/pull/12","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/issues/12/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/statuses/a4c1bc4dd850dad12a299dce614fd0d9a6ed256d"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# New Commit at Pull Request Repository
#$json_str = '{"action":"synchronize","number":12,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"pull_request":{"number":12,"updated_at":"2015-04-24T08:08:21Z","created_at":"2015-04-24T08:08:21Z","head":{"sha":"1faeaefb10fcab7f91668980e77fadeeee38b462","ref":"support-pullrequest","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:support-pullrequest","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"ac4bff25f2f5cf7febec1e1d1c4599cbab4653c2","ref":"dev","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:dev","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"WIP support pull request","body":"support pull request webhook","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/pull/12","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/issues/12/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/statuses/1faeaefb10fcab7f91668980e77fadeeee38b462"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Pull Request Closed (Merged)
#$json_str = '{"action":"closed","number":1,"repository":{"name":"Slack","full_name":"shimba/Slack","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/Slack"},"pull_request":{"number":1,"updated_at":"2015-04-08T08:57:22Z","created_at":"2015-04-08T08:42:32Z","head":{"sha":"2c38a554fd46db98c3f993b7beacaaa491e9bc27","ref":"master","repo":{"name":"Slack","full_name":"shimba_testaccount/Slack","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"shimba.aislab@gmail.com","type":"User","site_admin":false,"created_at":"2015-03-29T01:25:02Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba_testaccount/Slack","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba_testaccount/Slack.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba_testaccount/Slack.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba_testaccount/Slack"},"label":"Taiki Shimba:master","user":{"login":"Taiki Shimba","email":"shimba.aislab@gmail.com","type":"User","site_admin":false,"created_at":"2015-03-29T01:25:02Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"d04004e5c4f3a419ec9cc5ff9e0a384e563bbf0b","ref":"master","repo":{"name":"Slack","full_name":"shimba/Slack","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/Slack"},"label":"Taiki Shimba:master","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"pull request test","body":"spaces","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/Slack/pull/1","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/1","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/1/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/1/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/issues/1/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/statuses/2c38a554fd46db98c3f993b7beacaaa491e9bc27"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Pull Request Reopened
#$json_str = '{"action":"reopened","number":12,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"pull_request":{"number":12,"updated_at":"2015-04-24T08:52:54Z","created_at":"2015-04-24T08:08:21Z","head":{"sha":"1faeaefb10fcab7f91668980e77fadeeee38b462","ref":"support-pullrequest","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:support-pullrequest","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"ac4bff25f2f5cf7febec1e1d1c4599cbab4653c2","ref":"dev","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:dev","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"WIP support pull request","body":"support pull request webhook","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/pull/12","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/issues/12/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/statuses/1faeaefb10fcab7f91668980e77fadeeee38b462"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';

function parse_commits($payload){
	$text  = 'Name: ' . $payload['repository']['owner']['login'];
	$text .= ', Repository: ' . $payload['repository']['name'];
	$branch  = str_replace('refs/heads/', '', $payload['ref']);
	$text .= ', Branch: ' . $branch . "\n";
	foreach ($payload['commits'] as $commit) {
		$text .= 'Comment: ' . $commit['message'];

		$text .= count($commit['added']) . ' added: ';
		$text .= join(", ", $commit['added']);
		$text .= ', ';

		$text .= count($commit['removed']) . ' removed: ';
		$text .= join(", ", $commit['removed']);
		$text .= ', ';

		$text .= count($commit['modified']) . ' modified: ';
		$text .= join(", ", $commit['modified']);
		$text .= ', ';

		$text .= "\n";
		$text .= $commit['html_url'] . "\n";
	}

	return array('text' => $text,
				 'username' => 'GitBucket Bot');
}

function parse_issue($payload){
	$issue = $payload['issue'];
	$action = $payload['action'];
	$sender = $payload['sender']['login'];
	$body = $issue['body'];
	$number = $issue['number'];
	$title = $issue['title'];
	$title_link = $payload['repository']['html_url'] . "/issues/" . $number;

	$pretext = '[' . $payload['repository']['name'] . '] ';

	$attachment = array();
	# closed
	if($action == "closed") {
		$link = '<' . $title_link . '|#' . $number . ' ' . $title . '>';
		$text = $pretext . 'Issue closed: ' . $link . ' by ' . $sender;
		$pretext .= 'Issue closed: ' . $title . ' by ' . $sender;
	}
	else{
		# opened
		if($action == "opened") {
			$pretext .= 'Issue created by ' . $sender;
			$text = $body;
		}
		# reopened
		else if($action == "reopened") {
			$pretext .= 'Issue reopened by ' . $sender;
			$text = $body;
		}
		# "created" also called when added comment on pull request
		else if($action == "created") {
			$pretext .= 'Issue commented by ' . $sender;
			$text = $payload['comment']['body'];
		}	

		$attachment['pretext'] = $pretext;
		$attachment['title'] = '#' . $number . ' ' . $title;
		$attachment['title_link'] = $title_link;
		$attachment['color'] = '#F29513';
	}

	$attachment["fallback"] = $pretext;
	$attachment["text"] = $text;

	return array('attachments' => [$attachment],
				 'username' => 'GitBucket Bot');
}

function parse_pull_request($payload){
	$pull_request = $payload['pull_request'];
	$action = $payload['action'];
	$title = $pull_request['title'];

	$text  = 'Name: ' . $payload['repository']['owner']['login'];
	$text .= ', Repository: ' . $payload['repository']['name'];
	$branch = $pull_request['head']['ref'];
	$text .= ', Branch: ' . $branch . "\n";

	# Pull request open
	if($action == "opened") {
		$text .= 'New Pull Request Opened: ' . $title . "\n";
		$text .= 'Comment: ' . $pull_request['body'] . "\n";
	}
	# Commit to pull request branch
	if($action == "synchronize") {
		$text .= 'New Commit at ' . $branch . ' by ' . $payload['sender']['login'] . ' [Pull request branch]' . "\n";
	}
	# Pull request closed (= merged.)
	if($action == "closed") {
		$text .= 'Closed pull request: ' . $title . "\n";
	}
	# Pull request reopened
	if($action == "reopened") {
		$text .= 'Reopened pull request: ' . $title . "\n";
	}
	$text .= $pull_request['html_url'] . "\n";

	return array('text' => $text,
				 'username' => 'GitBucket Bot');
}

$payload = json_decode($json_str, true);

# about push, commit
if(isset($payload['commits'])) {
	$firewebhook = 1;
	$post = parse_commits($payload);
}
# about issue
else if(isset($payload['issue'])) {
	$firewebhook = 1;
	$post = parse_issue($payload);
}
# about pull request
else if(isset($payload['pull_request'])) {
	$firewebhook = 1;
	$post = parse_pull_request($payload);
}

if( $firewebhook == 1) {
	$webhook = 'https://hooks.slack.com/services/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';
	$ch = curl_init($webhook);
	curl_setopt($ch, CURLOPT_POST, true);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_HTTPHEADER, array());
	curl_setopt($ch, CURLOPT_POSTFIELDS, array('payload' => json_encode($post)));
	curl_exec($ch);
	curl_close($ch);
}