# Commit
$json_str = '{"pusher":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"ref":"refs/heads/support-pullrequest","commits":[{"id":"1faeaefb10fcab7f91668980e77fadeeee38b462","message":"test commit pull request\n","timestamp":"2015-04-24T08:28:24Z","added":["GitBucketIntegration/README.md"],"removed":[],"modified":[],"author":{"name":"shimba","email":"is0020he@ed.ritsumei.ac.jp","date":"2015-04-24T08:28:24Z"},"committer":{"name":"shimba","email":"is0020he@ed.ritsumei.ac.jp","date":"2015-04-24T08:28:24Z"},"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/shimba/SlackIntegrations/commits/1faeaefb10fcab7f91668980e77fadeeee38b462","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/commit/1faeaefb10fcab7f91668980e77fadeeee38b462"}],"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":1,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":1,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"}}';

# Issue Opened
#$json_str = '{"action":"created","repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":12,"title":"WIP support pull request","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"open","created_at":"2015-04-24T08:08:21Z","updated_at":"2015-04-24T08:08:21Z","body":"support pull request webhook"},"comment":{"id":100,"user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"body":"comment test on conversation, comment test on conversation","created_at":"2015-04-24T08:19:29Z","updated_at":"2015-04-24T08:19:29Z"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Issue Commented
#$json_str = '{"action":"created","repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":12,"title":"WIP support pull request","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"open","created_at":"2015-04-24T08:08:21Z","updated_at":"2015-04-24T08:08:21Z","body":"support pull request webhook"},"comment":{"id":101,"user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"body":"こっめんと","created_at":"2015-04-24T08:31:12Z","updated_at":"2015-04-24T08:31:12Z"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Issue Closed
#$json_str = '{"action":"closed","number":23,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":1,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":1,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":23,"title":"Openテスト","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"open","created_at":"2015-04-26T10:25:46Z","updated_at":"2015-04-26T10:25:46Z","body":"テストコメント"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Issue Reopened
#$json_str = '{"action":"reopened","number":23,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":1,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":1,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"issue":{"number":23,"title":"Openテスト","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"state":"closed","created_at":"2015-04-26T10:25:46Z","updated_at":"2015-04-26T10:54:53Z","body":"テストコメント"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';

# Pull Request Opened
#$json_str = '{"action":"opened","number":12,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"pull_request":{"number":12,"updated_at":"2015-04-24T08:08:21Z","created_at":"2015-04-24T08:08:21Z","head":{"sha":"a4c1bc4dd850dad12a299dce614fd0d9a6ed256d","ref":"support-pullrequest","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:support-pullrequest","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"ac4bff25f2f5cf7febec1e1d1c4599cbab4653c2","ref":"dev","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:dev","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"WIP support pull request","body":"support pull request webhook","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/pull/12","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/issues/12/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/statuses/a4c1bc4dd850dad12a299dce614fd0d9a6ed256d"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# New Commit at Pull Request Repository
#$json_str = '{"action":"synchronize","number":12,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"pull_request":{"number":12,"updated_at":"2015-04-24T08:08:21Z","created_at":"2015-04-24T08:08:21Z","head":{"sha":"1faeaefb10fcab7f91668980e77fadeeee38b462","ref":"support-pullrequest","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:support-pullrequest","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"ac4bff25f2f5cf7febec1e1d1c4599cbab4653c2","ref":"dev","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:dev","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"WIP support pull request","body":"support pull request webhook","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/pull/12","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/issues/12/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/statuses/1faeaefb10fcab7f91668980e77fadeeee38b462"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Pull Request Closed (Merged)
#$json_str = '{"action":"closed","number":1,"repository":{"name":"Slack","full_name":"shimba/Slack","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/Slack"},"pull_request":{"number":1,"updated_at":"2015-04-08T08:57:22Z","created_at":"2015-04-08T08:42:32Z","head":{"sha":"2c38a554fd46db98c3f993b7beacaaa491e9bc27","ref":"master","repo":{"name":"Slack","full_name":"shimba_testaccount/Slack","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"shimba.aislab@gmail.com","type":"User","site_admin":false,"created_at":"2015-03-29T01:25:02Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba_testaccount/Slack","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba_testaccount/Slack.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba_testaccount/Slack.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba_testaccount/Slack"},"label":"Taiki Shimba:master","user":{"login":"Taiki Shimba","email":"shimba.aislab@gmail.com","type":"User","site_admin":false,"created_at":"2015-03-29T01:25:02Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"d04004e5c4f3a419ec9cc5ff9e0a384e563bbf0b","ref":"master","repo":{"name":"Slack","full_name":"shimba/Slack","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/Slack.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/Slack"},"label":"Taiki Shimba:master","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"pull request test","body":"spaces","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/Slack/pull/1","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/1","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/1/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/1/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/issues/1/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/Slack/statuses/2c38a554fd46db98c3f993b7beacaaa491e9bc27"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';
# Pull Request Reopened
#$json_str = '{"action":"reopened","number":12,"repository":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"pull_request":{"number":12,"updated_at":"2015-04-24T08:52:54Z","created_at":"2015-04-24T08:08:21Z","head":{"sha":"1faeaefb10fcab7f91668980e77fadeeee38b462","ref":"support-pullrequest","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:support-pullrequest","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"base":{"sha":"ac4bff25f2f5cf7febec1e1d1c4599cbab4653c2","ref":"dev","repo":{"name":"SlackIntegrations","full_name":"shimba/SlackIntegrations","description":"slack.php","watchers":0,"forks":0,"private":false,"default_branch":"master","owner":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"forks_count":0,"watchers_coun":0,"url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations","http_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","clone_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/git/shimba/SlackIntegrations.git","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations"},"label":"Taiki Shimba:dev","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}},"title":"WIP support pull request","body":"support pull request webhook","user":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"},"html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/shimba/SlackIntegrations/pull/12","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12","commits_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/commits","review_comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/12/comments","review_comment_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/pulls/comments/{number}","comments_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/issues/12/comments","statuses_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/repos/shimba/SlackIntegrations/statuses/1faeaefb10fcab7f91668980e77fadeeee38b462"},"sender":{"login":"Taiki Shimba","email":"is0020he@ed.ritsumei.ac.jp","type":"User","site_admin":true,"created_at":"2015-01-07T14:46:14Z","url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/api/v3/users/Taiki Shimba","html_url":"http://www.ais.ics.ritsumei.ac.jp/gitbucket/Taiki Shimba"}}';

$payload = json_decode($json_str, true);
$firewebhook = 0;
$usetext = 0;
$userich = 0;
$closeflag = 0;
$text  = 'Name: ' . $payload['repository']['owner']['login'];
$text .= ', Repository: ' . $payload['repository']['name'];
$pretext = '[' . $payload['repository']['name'];
if(isset($payload['ref'])) {
	$branch  = str_replace('refs/heads/', '', $payload['ref']);
	$text .= ', Branch: ' . $branch . "\n";
	$pretext .= ':' . $branch . '] ';
}
else if(isset($payload['pull_request'])) {
	$branch = $payload['pull_request']['head']['ref'];
	$text .= ', Branch: ' . $branch . "\n";
	$pretext .= ':' . $branch . '] ';
}
else {
	$text .= "\n";
	$pretext .= '] ';
}
$repurl = $payload['repository']['html_url'];
$repname = $payload['repository']['name'];
$repnameurl = '<' . $repurl . '|' . $repname . '>';
# about push, commit
if(isset($payload['commits'])) {
	$fireowebhook = 1;
	$usetext = 1;
	foreach ($payload['commits'] as $commit) {
		$text .= 'Comment: ' . $commit['message'];
		$text .= count($commit['added']) . ' added: ';
		foreach ($commit['added'] as $added) {
			$text .= $added;
			$text .= ', ';
		}
		if (count($commit['added']) == 0) {
			$text .= ', ';
		}
		$text .= count($commit['removed']) . ' removed: ';
		foreach ($commit['removed'] as $removed) {
			$text .= $removed;
			$text .= ', ';
		}
		if (count($commit['removed']) == 0) {
			$text .= ', ';
		}
		$text .= count($commit['modified']) . ' modified: ';
		foreach ($commit['modified'] as $modified) {
			$text .= $modified;
			$text .= ', ';
		}
		if (count($commit['modified']) == 0) {
			$text .= ', ';
		}
		$text .= "\n";
		$text .= $commit['html_url'] . "\n";
	}
}
# about issue
if(isset($payload['issue'])) {
	$firewebhook = 1;
	$color = '#F29513';
	$sender = $payload['sender']['login'];
	$issuetitle = $payload['issue']['title'];
	$issueurl = $payload['repository']['html_url'] . "/issues/" . $payload['issue']['number'];
	$issuevalue = $payload['issue']['body'];
	$issuenumber = $payload['issue']['number'];
	$issuetitleurl = '<' . $issueurl . '|#' . $issuenumber . ' ' . $issuetitle . '>';
	$title = '#' . $issuenumber . ' ' . $issuetitle;
	$titlelink = $issueurl;
	# opened
	if($payload['action'] == "opened") {
		$userich = 1;
		$fallback = $pretext . 'Issue created by ' . $sender;
		$pretext = $pretext . 'Issue created by ' . $sender;
		$value = $issuevalue;
	}
	# reopened
	if($payload['action'] == "reopened") {
		$userich = 1;
		$fallback = $pretext . 'Issue reopened by ' . $sender;
		$pretext = $pretext . 'Issue reopened by ' . $sender;
		$value = $issuevalue;
	}
	# "created" also called when added comment on pull request
	if($payload['action'] == "created") {
		$userich = 1;
		$fallback = $pretext . 'Issue commented by ' . $sender;
		$pretext = $pretext . 'Issue commented by ' . $sender;
		$value = $payload['comment']['body'];
	}
	# closed
	if($payload['action'] == "closed") {
		$closeflag = 1;
		$fallback = $pretext . 'Issue closed: ' . $issuetitle . ' by ' . $sender;
		$value = $pretext . 'Issue closed: ' . $issuetitleurl . ' by ' . $sender;
	}
}
# about pull request
if(isset($payload['pull_request'])) {
	$firewebhook = 1;
	$usetext = 1;
	$pullrequest = $payload['pull_request'];
	# Pull request open
	if($payload['action'] == "opened") {
		$text .= 'New Pull Request Opened: ' . $pullrequest['title'] . "\n";
		$text .= 'Comment: ' . $pullrequest['body'] . "\n";
		$text .= $pullrequest['html_url'] . "\n";
	}
	# Commit to pull request branch
	if($payload['action'] == "synchronize") {
		$text .= 'New Commit at ' . $pullrequest['head']['ref'] . ' by ' . $payload['sender']['login'] . ' [Pull request branch]' . "\n";
		$text .= $pullrequest['html_url'] . "\n";
	}
	# Pull request closed (= merged.)
	if($payload['action'] == "closed") {
		$text .= 'Closed pull request: ' . $pullrequest['title'] . "\n";
		$text .= $pullrequest['html_url'] . "\n";
	}
	# Pull request reopened
	if($payload['action'] == "reopened") {
		$text .= 'Reopened pull request: ' . $pullrequest['title'] . "\n";
		$text .= $pullrequest['html_url'] . "\n";
	}
}
if( $usetext == 1 ) {
	$post = array(
		'text'		=> $text,
		'username'	=>	'GitBucket Bot'
	);
}
if( $userich == 1 ) {
	$post = array(
		'attachments'       => [array(
			'fallback'	=>	$fallback,
			'pretext'	=>	$pretext,
			'title'		=>	$title,
			'title_link'	=>	$titlelink,
			'text'		=>	$value,
			'color'		=>	$color
		)],
		'username'	=>	'GitBucket Bot'
	);
}
if( $closeflag == 1 ) {
	$post = array(
		'attachments'       => [array(
			'fallback'	=>	$fallback,
			'text'		=>	$value
		)],
		'username'	=>	'GitBucket Bot'
	);
}
if( $firewebhook == 1) {
	$webhook = 'https://hooks.slack.com/services/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';
	$ch = curl_init($webhook);
	curl_setopt($ch, CURLOPT_POST, true);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_HTTPHEADER, array());
	curl_setopt($ch, CURLOPT_POSTFIELDS, array('payload' => json_encode($post)));
	curl_exec($ch);
	curl_close($ch);
}